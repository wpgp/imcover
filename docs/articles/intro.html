<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model-based approaches to immunization coverage estimations in `R`: An introduction to the `imcover` package • imcover</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model-based approaches to immunization coverage estimations in `R`: An introduction to the `imcover` package">
<meta property="og:description" content="imcover">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">imcover</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Model-based approaches to immunization coverage estimations in `R`: An introduction to the `imcover` package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_files/header-attrs-2.13/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model-based approaches to immunization coverage estimations in <code>R</code>: An introduction to the <code>imcover</code> package</h1>
                        <h4 class="author">Chris Jochem (<a href="mailto:w.c.jochem@soton.ac.uk" class="email">w.c.jochem@soton.ac.uk</a>)</h4>
            
            <h4 class="date">May 15, 2022</h4>
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p>National estimates of immunization coverage are crucial for monitoring and evaluating coverage levels and trends, as well as immunization goals and targets, at the national and international levels. There are multiple potential sources of information related to immunization coverage, and the challenge is to develop a statistically-principled method to make use of different data sources while accounting for their uncertainties.</p>
<p>The goal of the <code>imcover</code> package is to provide access to data download, processing and modelling tools and to support a Bayesian statistical modelling approach to generate national estimates of immunization coverage from multiple time series of data on coverage. <code>imcover</code> is built as part of the open-source statistical computing and modelling language, <code>R</code> (<a href="https://cran.r-project.org/">https://cran.r-project.org/</a>). This package is designed to support broadly replicable and reproducible analyses of immunization coverage.</p>
<p>This vignette will demonstrate some of the core functionality in the package, including:</p>
<ul>
<li>Downloading input data sources on coverage</li>
<li>Cleaning/processing/harmonizing data sources</li>
<li>Fitting a Bayesian statistical model and model outputs</li>
<li>Generating national coverage estimates and visualizing results</li>
</ul>
<div id="installation-and-set-up" class="section level3">
<h3 class="hasAnchor">
<a href="#installation-and-set-up" class="anchor"></a>Installation and set-up</h3>
<p><code>imcover</code> is not (yet) available for download from CRAN. It is currently in a private GitHub repository during development. Access can be granted to users for “beta testing.” Once downloaded, a user accesses the code library through <code>R</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the package within the R environment</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">imcover</span><span class="op">)</span></code></pre></div>
<p>All functions are documented and the help and examples can be accessed within <code>R</code> using the standard command <code>help</code> or <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code>.</p>
<p><code>imcover</code> was developed by <a href="https://www.worldpop.org/">WorldPop at the University of Southampton (https://www.worldpop.org/)</a>.</p>
</div>
<div id="accessing-and-downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-and-downloading-data" class="anchor"></a>Accessing and downloading data</h2>
<p>If a user does not have a dataset on their local computer, the first step in analysis is to acquire standardised data. Within <code>imcover</code> there is functionality to download several datasets from the WHO Immunization data portal (<a href="https://immunizationdata.who.int/listing.html">https://immunizationdata.who.int/listing.html</a>). These datasets include official coverage reports, administrative records, as well as household survey datasets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># download administrative and official records</span>
<span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download.html">download_coverage</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># download survey records</span>
<span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download.html">download_survey</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>As part of the download process, by default, several pre-processing steps are done to, e.g. reconcile differences in column names. In the case of survey datasets, a recall-bias adjustment is applied. The default processing behaviour can be changed by modifying the argument supplied to the download functions. Additionally, all the processing steps can be carried out using functions available in <code>imcover</code> if advanced users want more control over pre-processing.</p>
<p>The data files available from the WHO website require some additional cleaning before analysis. Notice that the data objects created by <code>imcover</code> can work with all standard <code>R</code> commands for selecting and modifying records.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Further data cleaning of immunization records</span>
<span class="co"># drop some record categories (PAB, HPV, WUENIC)</span>
<span class="va">cov</span> <span class="op">&lt;-</span> <span class="va">cov</span><span class="op">[</span><span class="va">cov</span><span class="op">$</span><span class="va">coverage_category</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ADMIN"</span>, <span class="st">"OFFICIAL"</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">cov</span><span class="op">$</span><span class="va">coverage_category</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">cov</span><span class="op">$</span><span class="va">coverage_category</span><span class="op">)</span>  <span class="co"># clean-up</span>

<span class="co"># create a combined dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">cov</span>, <span class="va">svy</span><span class="op">)</span>

<span class="co"># remove records with missing coverage values</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">coverage</span><span class="op">)</span>, <span class="op">]</span>

<span class="co"># mismatch in vaccine names between coverage and survey datasets</span>
<span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">antigen</span> <span class="op">==</span> <span class="st">'DTPCV1'</span>, <span class="st">'antigen'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'DTP1'</span>
<span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">antigen</span> <span class="op">==</span> <span class="st">'DTPCV2'</span>, <span class="st">'antigen'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'DTP2'</span>
<span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">antigen</span> <span class="op">==</span> <span class="st">'DTPCV3'</span>, <span class="st">'antigen'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'DTP3'</span></code></pre></div>
</div>
<div id="ic-data-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#ic-data-objects" class="anchor"></a><code>ic</code> data objects</h2>
<p>A unique feature of <code>imcover</code> is that it creates and works with a custom data extension, which we refer to as an immunization coverage data frame or an <code>ic.df</code>. This type of object has all the functionality of a standard <code>R</code> data frame while having additional functionality to store attributes to make it easier to work with the immunization coverage data and to keep track of what processing has been done to the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inspect a random sample of records</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;        region code year antigen coverage coverage_category   doses</span>
<span class="co">#&gt; 207931  SEARO  NPL 1989 TT2PLUS    21.00             admin      NA</span>
<span class="co">#&gt; 140816   AFRO  KEN 2020   ROTAC    84.25             admin 1259221</span>
<span class="co">#&gt; 22811    AFRO  BFA 2016    DTP3   102.96             admin  769490</span>
<span class="co">#&gt; 83270    EMRO  EGY 2006    VAD1    97.78             admin 1752483</span>
<span class="co">#&gt; 52075    WPRO  CHN 1992 TT2PLUS     2.00          official      NA</span>
<span class="co">#&gt; 152894   EMRO  LBN 2019    DTP3    93.48          official      NA</span>
<span class="co">#&gt;        target_number         name</span>
<span class="co">#&gt; 207931            NA        Nepal</span>
<span class="co">#&gt; 140816       1494648        Kenya</span>
<span class="co">#&gt; 22811         747362 Burkina Faso</span>
<span class="co">#&gt; 83270        1792361        Egypt</span>
<span class="co">#&gt; 52075             NA        China</span>
<span class="co">#&gt; 152894            NA      Lebanon</span>
<span class="co">#&gt;                                                antigen_description</span>
<span class="co">#&gt; 207931 Tetanus toxoid-containing vaccine, 2nd and subsequent doses</span>
<span class="co">#&gt; 140816                                        Rotavirus, last dose</span>
<span class="co">#&gt; 22811                             DTP-containing vaccine, 3rd dose</span>
<span class="co">#&gt; 83270                                          Vitamin A, 1st dose</span>
<span class="co">#&gt; 52075  Tetanus toxoid-containing vaccine, 2nd and subsequent doses</span>
<span class="co">#&gt; 152894                            DTP-containing vaccine, 3rd dose</span>
<span class="co">#&gt;        coverage_category_description surveyNameEnglish evidence validity</span>
<span class="co">#&gt; 207931       Administrative coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt; 140816       Administrative coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt; 22811        Administrative coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt; 83270        Administrative coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt; 52075              Official coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt; 152894             Official coverage              &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="co">#&gt;        Sample_Size surveyNameProduction collectBegin collectEnd cardsSeen</span>
<span class="co">#&gt; 207931          NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt; 140816          NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt; 22811           NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt; 83270           NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt; 52075           NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt; 152894          NA                 &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="co">#&gt;        ageVaccination ageInterview  sex adj_factor coverage_adj</span>
<span class="co">#&gt; 207931           &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span>
<span class="co">#&gt; 140816           &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span>
<span class="co">#&gt; 22811            &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span>
<span class="co">#&gt; 83270            &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span>
<span class="co">#&gt; 52075            &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span>
<span class="co">#&gt; 152894           &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;         NA           NA</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># note the type object</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt; [1] "ic.df"      "data.frame"</span></code></pre></div>
<p>For example, the <code>ic.df</code> objects have helper functions to tabulate records,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show all records</span>
<span class="fu"><a href="../reference/list_vaccines.html">list_vaccines</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>  <span class="co"># note the download files contain many vaccine</span>
<span class="co">#&gt;   [1] "BCG"                              "BCG-POST1DAY"                    </span>
<span class="co">#&gt;   [3] "BCG-WIN1DAY"                      "DIPHCV4"                         </span>
<span class="co">#&gt;   [5] "DIPHCV5"                          "DIPHCV6"                         </span>
<span class="co">#&gt;   [7] "DTP1"                             "DTP2"                            </span>
<span class="co">#&gt;   [9] "DTP3"                             "DTP4"                            </span>
<span class="co">#&gt;  [11] "FIPV1"                            "FIPV2"                           </span>
<span class="co">#&gt;  [13] "FLU_ALL"                          "FLU_CHILD1"                      </span>
<span class="co">#&gt;  [15] "FLU_CHILD2"                       "FLU_CHRONIC_ADULT"               </span>
<span class="co">#&gt;  [17] "FLU_CHRONIC_ALL"                  "FLU_CHRONIC_PED"                 </span>
<span class="co">#&gt;  [19] "FLU_ELDERLY"                      "FLU_HAJ"                         </span>
<span class="co">#&gt;  [21] "FLU_HCW"                          "FLU_OTHER"                       </span>
<span class="co">#&gt;  [23] "FLU_PW"                           "FLU_RESIDENT"                    </span>
<span class="co">#&gt;  [25] "FULL"                             "FULL (+HB)"                      </span>
<span class="co">#&gt;  [27] "FULL (+IPV +PENTA-POL-BOOSTER)"   "FULL (+IPV+YFV)"                 </span>
<span class="co">#&gt;  [29] "FULL (+PCV3)"                     "FULL (+ROTAC)"                   </span>
<span class="co">#&gt;  [31] "FULL (+YFV)"                      "FULL (ALL EXCL PCV AND BOOSTERS)"</span>
<span class="co">#&gt;  [33] "FULL (ALL EXCL PCV)"              "FULL &lt;1 YEAR"                    </span>
<span class="co">#&gt;  [35] "FULL(+PCV)"                       "FULL(+PCV3+YFV)"                 </span>
<span class="co">#&gt;  [37] "FULL(+ROTAC)"                     "FULL(+YF,+HEPB)"                 </span>
<span class="co">#&gt;  [39] "FULL(+YF,+PCV,+ROTAC)"            "FULL(+YFV)"                      </span>
<span class="co">#&gt;  [41] "HEPB_BD"                          "HEPB_BDALL"                      </span>
<span class="co">#&gt;  [43] "HEPB0"                            "HEPB1"                           </span>
<span class="co">#&gt;  [45] "HEPB2"                            "HEPB3"                           </span>
<span class="co">#&gt;  [47] "HEPB4"                            "HEPBB"                           </span>
<span class="co">#&gt;  [49] "HEPBBX"                           "HIB1"                            </span>
<span class="co">#&gt;  [51] "HIB2"                             "HIB3"                            </span>
<span class="co">#&gt;  [53] "HIB4"                             "HPV_FEM"                         </span>
<span class="co">#&gt;  [55] "HPV_MALE"                         "IPV"                             </span>
<span class="co">#&gt;  [57] "IPV1"                             "IPV1_FRAC"                       </span>
<span class="co">#&gt;  [59] "IPV1X"                            "IPV2"                            </span>
<span class="co">#&gt;  [61] "IPV2_FRAC"                        "IPV3"                            </span>
<span class="co">#&gt;  [63] "IPV4"                             "JAPENC"                          </span>
<span class="co">#&gt;  [65] "JAPENC_1"                         "JAPENC_C"                        </span>
<span class="co">#&gt;  [67] "MCV1"                             "MCV2"                            </span>
<span class="co">#&gt;  [69] "MCV2X"                            "MCV3"                            </span>
<span class="co">#&gt;  [71] "MEN_A_CONJ"                       "NONE"                            </span>
<span class="co">#&gt;  [73] "OPV"                              "PAB"                             </span>
<span class="co">#&gt;  [75] "PCV1"                             "PCV2"                            </span>
<span class="co">#&gt;  [77] "PCV3"                             "PCV4"                            </span>
<span class="co">#&gt;  [79] "PERCV_PW"                         "PERCV4"                          </span>
<span class="co">#&gt;  [81] "POL0"                             "POL1"                            </span>
<span class="co">#&gt;  [83] "POL1X"                            "POL2"                            </span>
<span class="co">#&gt;  [85] "POL3"                             "POL3+IPV1"                       </span>
<span class="co">#&gt;  [87] "POL4"                             "POL4+IPV1"                       </span>
<span class="co">#&gt;  [89] "RCV1"                             "RCV1X"                           </span>
<span class="co">#&gt;  [91] "RCV2"                             "RCV2X"                           </span>
<span class="co">#&gt;  [93] "RCV3"                             "ROTA1"                           </span>
<span class="co">#&gt;  [95] "ROTA2"                            "ROTAC"                           </span>
<span class="co">#&gt;  [97] "ROTACX"                           "TT1"                             </span>
<span class="co">#&gt;  [99] "TT1+"                             "TT2"                             </span>
<span class="co">#&gt; [101] "TT2+"                             "TT2PLUS"                         </span>
<span class="co">#&gt; [103] "TT3"                              "TT4"                             </span>
<span class="co">#&gt; [105] "TT5"                              "TTCV4"                           </span>
<span class="co">#&gt; [107] "TTCV5"                            "TTCV6"                           </span>
<span class="co">#&gt; [109] "TTT5"                             "TTTT10"                          </span>
<span class="co">#&gt; [111] "TTTTT+"                           "TYPHOID"                         </span>
<span class="co">#&gt; [113] "TYPHOID_CONJ"                     "VAD1"                            </span>
<span class="co">#&gt; [115] "YFV"</span></code></pre></div>
<p>Or to easily filter the records. Here we will subset the data for five core vaccines and a subset of time points.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset the records by vaccine and year for all countries</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ic_filter.html">ic_filter</a></span><span class="op">(</span><span class="va">dat</span>, 
                 vaccine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DTP1"</span>, <span class="st">"DTP3"</span>, <span class="st">"MCV1"</span>, <span class="st">"MCV2"</span>, <span class="st">"PCV3"</span><span class="op">)</span>,
                 time <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2018</span><span class="op">)</span>

<span class="co"># cross-tabulations of source and vaccine</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">coverage_category</span>, <span class="va">dat</span><span class="op">$</span><span class="va">antigen</span><span class="op">)</span>
<span class="co">#&gt;           </span>
<span class="co">#&gt;            DTP1 DTP3 MCV1 MCV2 PCV3</span>
<span class="co">#&gt;   admin    3020 3376 3320 2056  936</span>
<span class="co">#&gt;   official 3061 3508 3489 1997  967</span>
<span class="co">#&gt;   survey    594  643  637   56  163</span></code></pre></div>
<p>Other specialised methods are available to filter out records for a country after the year of national introduction.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset records based on year of vaccine introduction</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_yovi.html">filter_yovi</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">year</span>, <span class="va">dat</span><span class="op">$</span><span class="va">antigen</span><span class="op">)</span>  <span class="co"># notice year of introduction for PCV3</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt;        DTP1 DTP3 MCV1 MCV2 PCV3</span>
<span class="co">#&gt;   2000  310  377  353   14    0</span>
<span class="co">#&gt;   2001  291  353  345  112    0</span>
<span class="co">#&gt;   2002  281  350  340  112    0</span>
<span class="co">#&gt;   2003  302  378  368  127    0</span>
<span class="co">#&gt;   2004  343  396  398  148    2</span>
<span class="co">#&gt;   2005  369  420  416  166    2</span>
<span class="co">#&gt;   2006  341  385  384  166    3</span>
<span class="co">#&gt;   2007  372  419  421  190    8</span>
<span class="co">#&gt;   2008  351  391  385  187   12</span>
<span class="co">#&gt;   2009  359  401  398  200   28</span>
<span class="co">#&gt;   2010  357  402  398  207   68</span>
<span class="co">#&gt;   2011  374  411  408  215   89</span>
<span class="co">#&gt;   2012  373  416  414  231  136</span>
<span class="co">#&gt;   2013  363  394  394  243  165</span>
<span class="co">#&gt;   2014  365  398  393  254  194</span>
<span class="co">#&gt;   2015  367  398  397  286  234</span>
<span class="co">#&gt;   2016  378  411  408  301  261</span>
<span class="co">#&gt;   2017  396  421  420  322  287</span>
<span class="co">#&gt;   2018  383  406  406  336  283</span></code></pre></div>
<p>Some further pre-processing of immunization data has been found to be necessary in preparation for the statistical modelling. We introduce functions to make it easy to carry out these steps.</p>
<p>Firstly, some records observe inconsistencies in the levels of coverage between multi-dose vaccines. To maintain consistency, where coverage of later doses cannot exceed earlier doses, we model the ratio between first and third dose. In this example, we only adjust DTP1 and DTP3, but other multi-dose vaccines could be processed in a similar manner.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># adjustment - use ratio for DTP3</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ic_adjust.html">ic_ratio</a></span><span class="op">(</span><span class="va">dat</span>, numerator <span class="op">=</span> <span class="st">'DTP3'</span>, denominator <span class="op">=</span> <span class="st">'DTP1'</span><span class="op">)</span></code></pre></div>
<p>The <code>ic.df</code> object will now store a note that this processing step has been carried out so that the ratio is back-transformed and that coverage estimates and predictions are adjusted appropriately.</p>
<p>Secondly, we need to force coverage estimates to lie between 0% and 100%.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># maintain coverage between 0-100%</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ic_adjust.html">ic_adjust</a></span><span class="op">(</span><span class="va">dat</span>, coverage_adj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>The core of <code>imcover</code> is the functionality to fit a Bayesian statistical model of multiple time series. The sources of coverage data (in this example administrative, official and surveys) are taken as multiple, partial estimates of the true, unobserved immunization coverage in a country. A Bayesian estimation approach allows us to incorporate these multiple datasets, place prior beliefs on which sources are more reliable, share information between countries, and to quantify uncertainty in our estimate of the latent immunization coverage.</p>
<p><code>imcover</code> provides an interface to <a href="https://mc-stan.org/"><code>Stan</code> (https://mc-stan.org/)</a> for statistical computation. This means that, in addition to <code>imcover</code>, many of the tools for assessing model performance and visualizing results from <code>Stan</code> will work for <code>imcover</code> results.</p>
<p>In this demonstration will start by fitting a model to a single region of data using <code>ic_fit</code> by passing in the <code>ic.df</code> object and several arguments that control the posterior sampling.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># enable parallel processing</span>

<span class="co"># Fit model to a single region of data</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ic_fit.html">ic_fit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="st">'AFRO'</span>, <span class="op">]</span>, 
               chains <span class="op">=</span> <span class="fl">4</span>, 
               iter <span class="op">=</span> <span class="fl">2000</span>, 
               warmup <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<div id="model-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#model-outputs" class="anchor"></a>Model outputs</h3>
<p>After fitting the model, we can work with the parameter estimates and estimates of coverage. For example, we can easily make graphs of coverage estimates. Notice how <code>imcover</code> has a generic function defined to specially handle objects returned by <code>ic_fit</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot of coverage</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ic_filter.html">ic_filter</a></span><span class="op">(</span><span class="va">fit1</span>, vaccine <span class="op">=</span> <span class="st">'DTP1'</span>,
               country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'BWA'</span>, <span class="st">'SLE'</span>, <span class="st">'GHA'</span>, <span class="st">'NGA'</span><span class="op">)</span><span class="op">)</span>,
     ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/plotCov-1.png" width="480"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ic_filter.html">ic_filter</a></span><span class="op">(</span><span class="va">fit1</span>, vaccine <span class="op">=</span> <span class="st">'DTP3'</span>,
               country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'BWA'</span>, <span class="st">'SLE'</span>, <span class="st">'GHA'</span>, <span class="st">'NGA'</span><span class="op">)</span><span class="op">)</span>,
     ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="intro_files/figure-html/plotCov2-1.png" alt="Example results of modelled immunization coverage estimates for selected countries and vaccines." width="480"><p class="caption">
Example results of modelled immunization coverage estimates for selected countries and vaccines.
</p>
</div>
<p>The main output of the model is a table of coverage estimates for each country, vaccine, and time point along with uncertainty around each estimate. We can extract these data as a table, save them to a data frame, or write them out to a file for use in a report.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extracting coverage estimates</span>
<span class="va">ic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ic_coverage.html">ic_coverage</a></span><span class="op">(</span><span class="va">fit1</span>, 
                  stat <span class="op">=</span> <span class="st">"quantile"</span>, <span class="co"># customise the summary function</span>
                  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ic</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt;        country time vaccine     2.5%      50%    97.5%</span>
<span class="co">#&gt; mu[1]      AGO 2000    DTP1 48.71852 67.83581 81.76032</span>
<span class="co">#&gt; mu[2]      AGO 2001    DTP1 32.13896 62.44410 84.02413</span>
<span class="co">#&gt; mu[3]      AGO 2002    DTP1 39.57595 70.26706 86.64744</span>
<span class="co">#&gt; mu[4]      AGO 2003    DTP1 44.89012 72.22582 89.35642</span>
<span class="co">#&gt; mu[5]      AGO 2004    DTP1 52.35678 75.80592 91.26388</span>
<span class="co">#&gt; mu[6]      AGO 2005    DTP1 52.34921 74.65095 87.82431</span>
<span class="co">#&gt; mu[7]      AGO 2006    DTP1 55.65966 78.36558 90.90806</span>
<span class="co">#&gt; mu[8]      AGO 2007    DTP1 80.96794 88.97504 94.92721</span>
<span class="co">#&gt; mu[9]      AGO 2008    DTP1 91.13137 96.88844 98.99340</span>
<span class="co">#&gt; mu[10]     AGO 2009    DTP1 86.65440 94.36350 98.19124</span></code></pre></div>
</div>
<div id="predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#predictions" class="anchor"></a>Predictions</h3>
<p>Once we have the fitted model, we can also use it to predict coverage to time points in the near future.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict for future time points (3 years post 2018)</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.icfit.html">predict</a></span><span class="op">(</span><span class="va">fit1</span>, t <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>  <span class="co"># update icfit to include 'prediction' info</span>

<span class="co"># Update the graph </span>
<span class="co"># Automatically include fitted estimates, observed data, and predictions</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ic_filter.html">ic_filter</a></span><span class="op">(</span><span class="va">fit1</span>, vaccine <span class="op">=</span> <span class="st">'DTP1'</span>,
               country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'BWA'</span>, <span class="st">'SLE'</span>, <span class="st">'GHA'</span>, <span class="st">'NGA'</span><span class="op">)</span><span class="op">)</span>,
     ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/plotPred-1.png" width="480"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ic_filter.html">ic_filter</a></span><span class="op">(</span><span class="va">fit1</span>, vaccine <span class="op">=</span> <span class="st">'DTP3'</span>,
               country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'BWA'</span>, <span class="st">'SLE'</span>, <span class="st">'GHA'</span>, <span class="st">'NGA'</span><span class="op">)</span><span class="op">)</span>,
     ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="intro_files/figure-html/plotPred2-1.png" alt="Example reults of estimated immunization coverage with future predictions to the right of the dashed lines. Overlaid with observed data points." width="480"><p class="caption">
Example reults of estimated immunization coverage with future predictions to the right of the dashed lines. Overlaid with observed data points.
</p>
</div>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>This vignette has introduced the core functionality of the <code>imcover</code> package and its use in modelling national time series of immunization coverage. Providing a coordinated toolset to download, process, and model immunization data should allow for consistent analyses whose methods are transparent and replicable.</p>
<p>There are a few additional options in the package. For instance, multiple regions of data can be supplied to <code>ic_fit</code> and then region-specific models can be executed. In the posterior analyses, population-weighted regional summaries of coverage can also be calculated. Similar to <code>ic_coverage</code>, users can customize the summary functions. Finally, the <code>Stan</code> models allow for significant flexibility in defining statistical models. The package specifies reasonable default values for the models to replicate our analyses, but users can explore the sensitivity of these settings by easily adjusting the parameters within <code>R</code> and re-running the models without having to interact with the <code>Stan</code> code.</p>
<p>Feedback on the package is welcome. Please email Chris Jochem (<a href="mailto:w.c.jochem@soton.ac.uk" class="email">w.c.jochem@soton.ac.uk</a>)</p>
<hr>
<pre><code>#&gt; R version 4.1.3 (2022-03-10)
#&gt; Platform: x86_64-pc-linux-gnu (64-bit)
#&gt; Running under: Ubuntu 20.04.4 LTS
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
#&gt; 
#&gt; locale:
#&gt;  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
#&gt;  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
#&gt;  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
#&gt;  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
#&gt; [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] imcover_0.2.4
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.7           prettyunits_1.1.1    ps_1.6.0            
#&gt;  [4] rprojroot_2.0.2      digest_0.6.29        utf8_1.2.2          
#&gt;  [7] V8_3.4.2             cellranger_1.1.0     R6_2.5.1            
#&gt; [10] stats4_4.1.3         evaluate_0.15        highr_0.9           
#&gt; [13] ggplot2_3.3.5        pillar_1.7.0         rlang_1.0.2         
#&gt; [16] readxl_1.3.1         curl_4.3.2           rstudioapi_0.13     
#&gt; [19] callr_3.7.0          jquerylib_0.1.3      rmarkdown_2.13      
#&gt; [22] pkgdown_1.6.1        labeling_0.4.2       textshaping_0.3.5   
#&gt; [25] desc_1.4.0           stringr_1.4.0        loo_2.5.1           
#&gt; [28] munsell_0.5.0        compiler_4.1.3       xfun_0.30           
#&gt; [31] rstan_2.21.2         pkgconfig_2.0.3      systemfonts_1.0.4   
#&gt; [34] pkgbuild_1.3.1       rstantools_2.1.1     htmltools_0.5.2     
#&gt; [37] tidyselect_1.1.0     tibble_3.1.6         gridExtra_2.3       
#&gt; [40] codetools_0.2-18     matrixStats_0.61.0   fansi_1.0.3         
#&gt; [43] crayon_1.5.1         dplyr_1.0.5          withr_2.5.0         
#&gt; [46] grid_4.1.3           jsonlite_1.8.0       gtable_0.3.0        
#&gt; [49] lifecycle_1.0.1      magrittr_2.0.3       StanHeaders_2.21.0-7
#&gt; [52] scales_1.1.1         RcppParallel_5.1.5   cli_3.2.0           
#&gt; [55] stringi_1.7.6        cachem_1.0.6         farver_2.1.0        
#&gt; [58] fs_1.5.2             bslib_0.2.4          ellipsis_0.3.2      
#&gt; [61] ragg_1.1.3           generics_0.1.0       vctrs_0.4.0         
#&gt; [64] tools_4.1.3          glue_1.6.2           purrr_0.3.4         
#&gt; [67] abind_1.4-5          processx_3.5.3       parallel_4.1.3      
#&gt; [70] fastmap_1.1.0        yaml_2.3.5           inline_0.3.19       
#&gt; [73] colorspace_2.0-3     memoise_2.0.1        knitr_1.38          
#&gt; [76] sass_0.3.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Warren Jochem, Edson Utazi, Sahu Sujit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
